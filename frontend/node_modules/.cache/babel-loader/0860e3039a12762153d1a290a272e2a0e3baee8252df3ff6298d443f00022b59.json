{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Desktop\\\\odoo_Hackthone\\\\v1\\\\frontend\\\\src\\\\components\\\\auth\\\\OAuthCallback.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useContext, useState } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { AuthContext } from '../../context/AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OAuthCallback = () => {\n  _s();\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const {\n    login\n  } = useContext(AuthContext);\n  const [status, setStatus] = useState('Processing...');\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const processCallback = async () => {\n      try {\n        console.log('OAuth Callback: Started');\n        console.log('URL:', window.location.href);\n        const token = searchParams.get('token');\n        const refreshToken = searchParams.get('refreshToken');\n        const errorParam = searchParams.get('error');\n        console.log('OAuth Callback: Params', {\n          hasToken: !!token,\n          hasRefreshToken: !!refreshToken,\n          error: errorParam\n        });\n        if (errorParam) {\n          setStatus('Authentication failed');\n          setError(errorParam);\n          console.error('OAuth error:', errorParam);\n          setTimeout(() => navigate('/login?error=' + errorParam), 2000);\n          return;\n        }\n        if (!token || !refreshToken) {\n          setStatus('Missing credentials');\n          setError('No tokens received');\n          console.error('Missing tokens');\n          setTimeout(() => navigate('/login?error=missing_tokens'), 2000);\n          return;\n        }\n        setStatus('Saving credentials...');\n        console.log('OAuth Callback: Saving tokens to localStorage');\n        localStorage.setItem('token', token);\n        localStorage.setItem('refreshToken', refreshToken);\n        setStatus('Fetching user data...');\n        console.log('OAuth Callback: Fetching user data from API');\n        const response = await fetch('http://localhost:5000/api/auth/me', {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json'\n          }\n        });\n        console.log('OAuth Callback: API response status:', response.status);\n        if (!response.ok) {\n          const errorData = await response.json();\n          console.error('OAuth Callback: API error', errorData);\n          throw new Error(errorData.message || 'Failed to fetch user data');\n        }\n        const userData = await response.json();\n        console.log('OAuth Callback: User data received:', userData);\n        setStatus('Logging in...');\n\n        // Login with user data\n        const userWithTokens = {\n          ...userData,\n          token,\n          refreshToken\n        };\n        console.log('OAuth Callback: Calling login with:', userWithTokens);\n        login(userWithTokens);\n        setStatus('Success! Redirecting...');\n\n        // Redirect based on role\n        setTimeout(() => {\n          console.log('OAuth Callback: Redirecting user, role:', userData.role);\n          if (userData.role === 'Admin') {\n            console.log('Redirecting to: /dashboard');\n            navigate('/dashboard', {\n              replace: true\n            });\n          } else if (userData.role === 'Manager') {\n            console.log('Redirecting to: /pending-approvals');\n            navigate('/pending-approvals', {\n              replace: true\n            });\n          } else {\n            console.log('Redirecting to: /submit-expense');\n            navigate('/submit-expense', {\n              replace: true\n            });\n          }\n        }, 500);\n      } catch (error) {\n        console.error('OAuth callback error:', error);\n        setStatus('Error occurred');\n        setError(error.message);\n        setTimeout(() => navigate('/login?error=callback_failed'), 2000);\n      }\n    };\n    processCallback();\n  }, [searchParams, navigate, login]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '100vh',\n      flexDirection: 'column',\n      gap: '1.5rem',\n      padding: '2rem'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"spinner\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        fontSize: '1.5rem',\n        fontWeight: '600',\n        color: '#333'\n      },\n      children: status\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        fontSize: '1rem',\n        color: '#e74c3c',\n        textAlign: 'center'\n      },\n      children: [\"Error: \", error]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        fontSize: '0.9rem',\n        color: '#666'\n      },\n      children: \"Please wait while we complete your sign-in...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 5\n  }, this);\n};\n_s(OAuthCallback, \"M2J/Ti15yJNe3Hc+B0CyHVLQawQ=\", false, function () {\n  return [useSearchParams, useNavigate];\n});\n_c = OAuthCallback;\nexport default OAuthCallback;\nvar _c;\n$RefreshReg$(_c, \"OAuthCallback\");","map":{"version":3,"names":["React","useEffect","useContext","useState","useNavigate","useSearchParams","AuthContext","jsxDEV","_jsxDEV","OAuthCallback","_s","searchParams","navigate","login","status","setStatus","error","setError","processCallback","console","log","window","location","href","token","get","refreshToken","errorParam","hasToken","hasRefreshToken","setTimeout","localStorage","setItem","response","fetch","headers","ok","errorData","json","Error","message","userData","userWithTokens","role","replace","style","display","justifyContent","alignItems","height","flexDirection","gap","padding","children","className","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","fontWeight","color","textAlign","_c","$RefreshReg$"],"sources":["C:/Users/Admin/Desktop/odoo_Hackthone/v1/frontend/src/components/auth/OAuthCallback.jsx"],"sourcesContent":["import React, { useEffect, useContext, useState } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { AuthContext } from '../../context/AuthContext';\r\n\r\nconst OAuthCallback = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const { login } = useContext(AuthContext);\r\n  const [status, setStatus] = useState('Processing...');\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const processCallback = async () => {\r\n      try {\r\n        console.log('OAuth Callback: Started');\r\n        console.log('URL:', window.location.href);\r\n        \r\n        const token = searchParams.get('token');\r\n        const refreshToken = searchParams.get('refreshToken');\r\n        const errorParam = searchParams.get('error');\r\n\r\n        console.log('OAuth Callback: Params', { \r\n          hasToken: !!token, \r\n          hasRefreshToken: !!refreshToken, \r\n          error: errorParam \r\n        });\r\n\r\n        if (errorParam) {\r\n          setStatus('Authentication failed');\r\n          setError(errorParam);\r\n          console.error('OAuth error:', errorParam);\r\n          setTimeout(() => navigate('/login?error=' + errorParam), 2000);\r\n          return;\r\n        }\r\n\r\n        if (!token || !refreshToken) {\r\n          setStatus('Missing credentials');\r\n          setError('No tokens received');\r\n          console.error('Missing tokens');\r\n          setTimeout(() => navigate('/login?error=missing_tokens'), 2000);\r\n          return;\r\n        }\r\n\r\n        setStatus('Saving credentials...');\r\n        console.log('OAuth Callback: Saving tokens to localStorage');\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('refreshToken', refreshToken);\r\n\r\n        setStatus('Fetching user data...');\r\n        console.log('OAuth Callback: Fetching user data from API');\r\n        \r\n        const response = await fetch('http://localhost:5000/api/auth/me', {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n\r\n        console.log('OAuth Callback: API response status:', response.status);\r\n\r\n        if (!response.ok) {\r\n          const errorData = await response.json();\r\n          console.error('OAuth Callback: API error', errorData);\r\n          throw new Error(errorData.message || 'Failed to fetch user data');\r\n        }\r\n\r\n        const userData = await response.json();\r\n        console.log('OAuth Callback: User data received:', userData);\r\n\r\n        setStatus('Logging in...');\r\n        \r\n        // Login with user data\r\n        const userWithTokens = {\r\n          ...userData,\r\n          token,\r\n          refreshToken\r\n        };\r\n        \r\n        console.log('OAuth Callback: Calling login with:', userWithTokens);\r\n        login(userWithTokens);\r\n\r\n        setStatus('Success! Redirecting...');\r\n        \r\n        // Redirect based on role\r\n        setTimeout(() => {\r\n          console.log('OAuth Callback: Redirecting user, role:', userData.role);\r\n          \r\n          if (userData.role === 'Admin') {\r\n            console.log('Redirecting to: /dashboard');\r\n            navigate('/dashboard', { replace: true });\r\n          } else if (userData.role === 'Manager') {\r\n            console.log('Redirecting to: /pending-approvals');\r\n            navigate('/pending-approvals', { replace: true });\r\n          } else {\r\n            console.log('Redirecting to: /submit-expense');\r\n            navigate('/submit-expense', { replace: true });\r\n          }\r\n        }, 500);\r\n\r\n      } catch (error) {\r\n        console.error('OAuth callback error:', error);\r\n        setStatus('Error occurred');\r\n        setError(error.message);\r\n        setTimeout(() => navigate('/login?error=callback_failed'), 2000);\r\n      }\r\n    };\r\n\r\n    processCallback();\r\n  }, [searchParams, navigate, login]);\r\n\r\n  return (\r\n    <div style={{ \r\n      display: 'flex', \r\n      justifyContent: 'center', \r\n      alignItems: 'center', \r\n      height: '100vh',\r\n      flexDirection: 'column',\r\n      gap: '1.5rem',\r\n      padding: '2rem'\r\n    }}>\r\n      <div className=\"spinner\"></div>\r\n      <h2 style={{ fontSize: '1.5rem', fontWeight: '600', color: '#333' }}>\r\n        {status}\r\n      </h2>\r\n      {error && (\r\n        <p style={{ fontSize: '1rem', color: '#e74c3c', textAlign: 'center' }}>\r\n          Error: {error}\r\n        </p>\r\n      )}\r\n      <p style={{ fontSize: '0.9rem', color: '#666' }}>\r\n        Please wait while we complete your sign-in...\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OAuthCallback;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}